(function(g,i){typeof exports=="object"&&typeof module<"u"?i(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],i):(g=typeof globalThis<"u"?globalThis:g||self,i(g.VueDraggableGridDashboard={},g.Vue))})(this,(function(g,i){"use strict";const C={class:"dg-container"},N=["id","onMousedown"],B=["onMousedown"],V={class:"dg-actions"},k=((w,X)=>{const a=w.__vccOpts||w;for(const[y,d]of X)a[y]=d;return a})(i.defineComponent({__name:"DraggableGrid",props:{modelValue:{type:Array,required:!0},gridXCount:{type:Number,default:12},gridYCount:{type:Number,default:9},gridGap:{type:Number,default:10},minWidth:{type:Number,default:2},minHeight:{type:Number,default:2},defaultSize:{type:Object,default:()=>({width:3,height:3})},addText:{type:String,default:"New Card"}},emits:["update:modelValue","add","change","delete"],setup(w,{emit:X}){const a=w,y=X,d=i.computed({get:()=>a.modelValue,set:o=>y("update:modelValue",o)}),x=i.ref(50),h=i.ref(50),Y=i.computed(()=>a.gridXCount),p=i.ref(a.gridYCount),r=i.computed(()=>a.gridGap),f=i.ref(null),_=()=>{if(!f.value)return;const o=f.value.offsetWidth-32,s=f.value.offsetHeight-32;if(o<=0||s<=0){setTimeout(_,100);return}const e=o-(Y.value-1)*r.value,n=s-(p.value-1)*r.value;x.value=Math.max(60,Math.floor(e/Y.value)),h.value=Math.max(60,Math.floor(n/p.value))},v=i.ref({state:!1,index:null}),m=i.ref({state:!1,index:null}),$=()=>{y("add")},M=(o,s,e,n,t,u)=>!t.some(l=>l.id===u.id?!1:o<l.position.gridX+l.size.width&&o+e>l.position.gridX&&s<l.position.gridY+l.size.height&&s+n>l.position.gridY),L=()=>{const o=d.value.map((e,n)=>({...e,index:n})).sort((e,n)=>e.position.gridY-n.position.gridY||e.position.gridX-n.position.gridX),s=[];o.forEach(e=>{let n=e.position.gridX,t=e.position.gridY;if(M(n,t,e.size.width,e.size.height,s,e))for(;t>0&&M(n,t-1,e.size.width,e.size.height,s,e);)t-=1;else for(;!M(n,t,e.size.width,e.size.height,s,e);)t+=1;d.value[e.index].position.gridY!==t&&(d.value[e.index].position.gridY=t,t+e.size.height>p.value&&(p.value=t+e.size.height),y("change",d.value[e.index],e.index)),s.push(e)})},c=i.ref(null),D=i.ref({x:0,y:0}),T=(o,s,e)=>{if(!f.value)return;v.value.state=!0,v.value.index=e;const n=document.querySelector(`#dg_${s.id}`),t=f.value.querySelector(".dg-grid");c.value=n.cloneNode(!0),c.value.classList.add("cloned"),c.value.classList.remove("isDragging"),D.value={x:o.clientX-n.offsetLeft,y:o.clientY-n.offsetTop},t.appendChild(c.value),c.value.style.left=`${n.offsetLeft}px`,c.value.style.top=`${n.offsetTop}px`;const u=z=>A(z,e),l=()=>P(u,l);document.addEventListener("mousemove",u),document.addEventListener("mouseup",l),o.preventDefault()},G=(o,s)=>{const e=Y.value-s.size.width,n=p.value-s.size.height,t={...o};return t.gridX<0?t.gridX=0:t.gridX>e&&(t.gridX=e),t.gridY<0?t.gridY=0:t.gridY>n&&(t.gridY=n),t},q=(o,s,e)=>{const n=(t,u,l)=>t*(u===1?x.value:h.value)+(l?t:t-1)*r.value;return o.x<n(e.position.gridX+e.size.width,1)&&o.x+n(s.size.width,1)>n(e.position.gridX,1,!0)&&o.y<n(e.position.gridY+1,2)&&o.y+h.value>n(e.position.gridY,2,!0)},A=(o,s)=>{if(!v.value.state)return;o.preventDefault();const e=o.clientX-D.value.x,n=o.clientY-D.value.y;c.value.style.left=`${e}px`,c.value.style.top=`${n}px`;const t=d.value[s],u=G({gridX:Math.round(e/(x.value+r.value)),gridY:Math.floor(n/(h.value+r.value))},t);d.value.forEach((l,z)=>{s!==z&&q({x:e,y:n},t,l)&&(l.position={gridX:l.position.gridX,gridY:l.position.gridY+1})}),t.position=u,L()},P=(o,s)=>{v.value.state=!1,v.value.index=null,f.value.querySelector(".dg-grid").removeChild(c.value),c.value=null,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",s)},F=(o,s,e)=>{m.value.state=!0,m.value.index=e;const n=o.clientX,t=o.clientY,u=d.value[e].size.width,l=d.value[e].size.height,z=b=>O(b,e,u,l,n,t),E=()=>j(z,E);document.addEventListener("mousemove",z),document.addEventListener("mouseup",E)},R=(o,s)=>{const e=Y.value-s.position.gridX,n=p.value-s.position.gridY,t={...o};return t.width>e&&(t.width=e),t.height>n&&(p.value=s.position.gridY+t.height),t.width<a.minWidth&&(t.width=a.minWidth),t.height<a.minHeight&&(t.height=a.minHeight),t},O=(o,s,e,n,t,u)=>{if(!m.value.state)return;o.preventDefault();const l=o.clientX-t,z=o.clientY-u,E=Math.max(a.minWidth,e+Math.round(l/(x.value+r.value))),b=Math.max(a.minHeight,n+Math.round(z/(h.value+r.value))),H=d.value[s];H.size=R({width:E,height:b},H),L()},j=(o,s)=>{m.value.state=!1,m.value.index=null,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",s)},S=()=>_();return i.onMounted(()=>{f.value=document.querySelector(".dg-container"),f.value&&i.nextTick(()=>{_(),window.addEventListener("resize",S)})}),i.onBeforeUnmount(()=>{window.removeEventListener("resize",S)}),(o,s)=>(i.openBlock(),i.createElementBlock("div",C,[i.createElementVNode("div",{class:"dg-grid",style:i.normalizeStyle({gap:r.value+"px"})},[(i.openBlock(!0),i.createElementBlock(i.Fragment,null,i.renderList(Y.value*p.value,e=>(i.openBlock(),i.createElementBlock("div",{key:e,class:i.normalizeClass(["dg-cell",{"dg-cell-visible":v.value.state||m.value.state}]),style:i.normalizeStyle({flex:`0 0 ${x.value}px`,height:`${h.value}px`})},null,6))),128)),(i.openBlock(!0),i.createElementBlock(i.Fragment,null,i.renderList(d.value,(e,n)=>(i.openBlock(),i.createElementBlock("div",{key:e.id,class:i.normalizeClass(["dg-item",{isResizing:m.value.index===n,isDragging:v.value.index===n}]),id:"dg_"+e.id,style:i.normalizeStyle({width:`${e.size.width*x.value+(e.size.width-1)*r.value}px`,height:`${e.size.height*h.value+(e.size.height-1)*r.value}px`,left:e.position.gridX*(x.value+r.value)+"px",top:e.position.gridY*(h.value+r.value)+"px",zIndex:v.value.index===n||m.value.index===n?3:2}),onMousedown:i.withModifiers(t=>T(t,e,n),["stop"])},[s[1]||(s[1]=i.createElementVNode("div",{class:"dg-move-icon"},null,-1)),i.createElementVNode("div",{class:"dg-resizer",onMousedown:i.withModifiers(t=>F(t,e,n),["stop"])},null,40,B),i.createElementVNode("div",{class:"dg-card",onMousedown:s[0]||(s[0]=i.withModifiers(()=>{},["stop"]))},[i.renderSlot(o.$slots,"card",{item:e,index:n},void 0,!0)],32)],46,N))),128))],4),i.createElementVNode("div",V,[i.createElementVNode("button",{class:"dg-btn",onClick:$},i.toDisplayString(w.addText),1)])]))}}),[["__scopeId","data-v-ff75ed7d"]]),W={install(w){w.component("DraggableGrid",k)}};g.DraggableGrid=k,g.default=W,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
